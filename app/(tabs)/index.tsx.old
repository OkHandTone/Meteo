import { useState } from "react";
import { Image, ScrollView, StyleSheet, Text, TextInput, TouchableOpacity, View } from "react-native";

export default function HomeScreen() {
  const [city, setCity] = useState("");
  const [temperature, setTemperature] = useState(null);
  const [error, setError] = useState("");
    const [localisation, setLocalisation] = useState("");
    const [icon_meteo, setIcon] = useState("");
    const [ville, setVille] = useState("");

  const API_KEY = "86b213e747384342a67150923263001";
  const requete = `https://api.weatherapi.com/v1/current.json?key=${API_KEY}&q=${city}`;

  const requete_api = async () => {
    setTemperature(null);
    setError("");

    fetch(requete)
        .then((response) => response.json())
        .then((data) => {
            if (data.current) {
                let latitude = data.location.lat;
                let longitude = data.location.lon;
                let icon_meteo = data.current.condition.icon;
                let ville = data.location.name;
                setVille(ville);
                setIcon(icon_meteo);
                setLocalisation(`Lat: ${latitude}, Lon: ${longitude}`);
                setTemperature(data.current.temp_c);
            } else {
                setError("Ville non trouv√©e");
            }
        });
    };


  return (
    <ScrollView contentContainerStyle={styles.container}>
      <Text style={styles.title}>Mets - üçµ - üí¶</Text>
      <Image 
        source={{ uri: "https://imgs.search.brave.com/6FeVZQwwhsyQqVSTdwkVxkg329GvwahFHvOKPgrzR-g/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9tZWRp/YTMuZ2lwaHkuY29t/L21lZGlhL3YxLlky/bGtQVGM1TUdJM05q/RXhNVzgwTjJvME1H/NTJjREZoY3poa01X/eDVPWFY1YUhKeU9U/ZHNlVEoyY1hKMFpE/SXlabWhzWlNabGNE/MTJNVjluYVdaelgz/TmxZWEpqYUNaamRE/MW4vZFEyQ2xKU0Z3/dTJ6TERLUDRVLzIw/MC5naWY.gif" }} 
        style={styles.image} 
        resizeMode="cover" 
      />

      <TextInput 
        style={styles.input} 
        placeholder="Rechercher une ville..." 
        placeholderTextColor="#888"
        value={city}
        onChangeText={setCity}
      />

      <TouchableOpacity style={styles.button} onPress={requete_api}>
        <Text style={styles.buttonText}>Rechercher</Text>
      </TouchableOpacity>

      <Text>
        {temperature !== null && (
            <Text style={styles.temperature}>Temp√©rature: {temperature}¬∞C a : {ville} ,
            coordon√©e : {localisation}</Text>
            )}
            {error ? <Text style={styles.error}>{error}</Text> : null}
      </Text>

      <Image source={{ uri: `https:${icon_meteo}` }} style={{ width: 64, height: 64 }} />
      
      <Text style={styles.favoritesTitle}>Vos villes favorites :</Text>
      <View style={styles.favoritesContainer}>
        {["Paris", "Londres", "New York"].map((cityName, index) => (
          <View key={index} style={styles.favoriteItem}>
            <Text style={styles.favoriteText}>{cityName}</Text>
          </View>
        ))}
      </View>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: {
    flexGrow: 1,
    alignItems: 'center',
    backgroundColor: '#E0F7FA',
    padding: 20,
  },
  title: {
    fontSize: 28,
    fontWeight: 'bold',
    marginBottom: 20,
    textAlign: 'center',
    color: '#00796B',
  },
  image: {
    width: '100%',
    height: 220,
    borderRadius: 15,
    marginBottom: 20,
    overflow: 'hidden',
  },
  input: {
    height: 50,
    borderColor: '#00796B',
    borderWidth: 2,
    width: '100%',
    paddingLeft: 15,
    marginBottom: 20,
    borderRadius: 25,
    backgroundColor: '#FFFFFF',
    elevation: 2,
  },
  button: {
    backgroundColor: '#00796B',
    paddingVertical: 12,
    paddingHorizontal: 30,
    borderRadius: 25,
    marginBottom: 20,
  },
  buttonText: {
    color: '#FFFFFF',
    fontSize: 16,
    fontWeight: 'bold',
    textAlign: 'center',
  },
  temperature: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#00796B',
    marginBottom: 20,
  },
  error: {
    color: 'red',
    marginBottom: 20,
  },
  favoritesTitle: {
    fontSize: 20,
    fontWeight: 'bold',
    marginBottom: 10,
    color: '#004D40',
  },
  favoritesContainer: {
    width: '100%',
  },
  favoriteItem: {
    paddingVertical: 12,
    borderBottomWidth: 1,
    borderBottomColor: '#B2DFDB',
    backgroundColor: '#FFFFFF',
    borderRadius: 10,
    marginBottom: 5,
    elevation: 1,
    paddingLeft: 10,
  },
  favoriteText: {
    fontSize: 18,
    color: '#333',
  },
});
